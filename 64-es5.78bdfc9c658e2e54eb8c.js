function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var c=0;c<e.length;c++){var a=e[c];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,c){return e&&_defineProperties(t.prototype,e),c&&_defineProperties(t,c),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{Fnjz:function(t,e,c){"use strict";c.r(e),c.d(e,"UploadcatalogPageModule",(function(){return m}));var a=c("ofXK"),i=c("3Pt+"),n=c("tyNb"),o=c("TEn/"),r=c("7pIB"),s=c("pwB6"),l=c("DVUX"),u=c("fXoL"),d=c("P6Fj"),p=c("NFeN");function h(t,e){if(1&t){var c=u.ic();u.hc(0,"div"),u.hc(1,"input",7,8),u.pc("change",(function(t){return u.Nc(c),u.tc().previewFile(t)})),u.gc(),u.hc(3,"button",9),u.pc("click",(function(){return u.Nc(c),u.Kc(2).click()})),u.hc(4,"mat-icon",10),u.Xc(5,"extension"),u.gc(),u.Xc(6," Add Products Catalog "),u.gc(),u.gc()}if(2&t){var a=u.tc();u.Ob(1),u.Cc("uploader",a.uploader)}}function g(t,e){if(1&t){var c=u.ic();u.hc(0,"div",11),u.hc(1,"button",12),u.pc("click",(function(){return u.Nc(c),u.tc().clearAllItems()})),u.hc(2,"mat-icon",10),u.Xc(3,"delete"),u.gc(),u.Xc(4," Clear All Products "),u.gc(),u.hc(5,"button",9),u.pc("click",(function(){return u.Nc(c),u.tc().saveAllItems()})),u.hc(6,"mat-icon",10),u.Xc(7,"save"),u.gc(),u.Xc(8," Save All Products "),u.gc(),u.gc()}}function f(t,e){if(1&t){var c=u.ic();u.hc(0,"app-productcard",13),u.pc("actionevent",(function(t){return u.Nc(c),u.tc().perform(t)})),u.gc()}if(2&t){var a=e.$implicit,i=u.tc();u.Cc("product",a)("productlist",i.crudList)("onpage","uploadcatalog")("catalogupload",!0)}}var v,y,b=[{path:"",component:(v=function(){function t(e,c,a,i,n,o,r,s){_classCallCheck(this,t),this.centerdb=e,this.ycat=c,this.toast=a,this.ydata=i,this.ygen=n,this.papa=o,this.yalert=r,this.photoUploadService=s,this.clearme=!0,this.productlimit=50,this.products=[],this.uploader=s.getUploader(),s.getUploader().clearQueue(),s.getUploader().cancelAll()}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.centerdb.currenttenant.subscribe((function(e){e&&(t.crudList=new s.p(s.R.getpath()+"/shop/products",t.ydata.getDatabase(),!0,t.ygen.getUid()),t.crudList.getList().subscribe((function(e){t.productlimit=e.length})))}))}},{key:"previewFile",value:function(t){var e=this;t.srcElement&&t.srcElement.files&&t.srcElement.files[0]&&(t.srcElement.files[0].name.includes(".csv")?(this.toast.pop("success","Got the event & processing "+t.target.files.length+" file","Ok"),this.toast.pop("warn","Reading files","Processing"),this.papa.parse(t.srcElement.files[0],{complete:function(t,c){t.errors.forEach((function(e){return t.data.splice(e.row,1)})),t.data.forEach((function(t){t.outofstock=!1,t.soldout=!1;try{t.$key=JSON.parse(t.$key)}catch(o){console.error(t.$key,o)}if(t.isorganic=e.giveflag(t.isorganic),t.istopsaver=e.giveflag(t.istopsaver),t.heavydiscount=e.giveflag(t.heavydiscount),t.newarrival=e.giveflag(t.newarrival),t.isveg=e.giveflag(t.isveg),t.uploaded=e.giveflag(t.uploaded),t.discount=e.getDiscount(t),t.variations){var c=t.variations.replace(/\|/g,",");try{var a=JSON.parse(c),i={},n=0;a.forEach((function(t){i[n]=t,n++})),n>0&&(t.variations=i)}catch(o){t.variations=null}}})),e.products=t.data.filter((function(t){return!t.uploaded}))},delimiter:",",header:!0})):this.yalert.errordata("Only CSV files are allowed"))}},{key:"giveflag",value:function(t){return!!t&&"true"==t.toLowerCase()}},{key:"getDiscount",value:function(t){var e=t.mrp;return(100*(e-t.price)/e).toFixed(0)}},{key:"savewithVariation",value:function(t){var e=this,c=this.ydata.getDatabase().createPushId(),a=t.variations;t.discount=this.getDiscount(t),this.ycat.recievedProductListKeyVal[t.$key]?(c=t.$key,delete t.variations,this.ydata.getDatabase().list(s.R.getpath()+"/shop/products/"+c+"/variations").remove(),this.crudList.updateList(t)):(delete t.$key,delete t.variations,this.crudList.getListRefer().set(c,t)),Object.values(a).forEach((function(t){e.ydata.getDatabase().list(s.R.getpath()+"/shop/products/"+c+"/variations").push(t)}))}},{key:"saveAllItems",value:function(){var t=this;this.yalert.openSnackBar("Saving All Products at once","Ok"),this.products.forEach((function(e){var c=e.$key;e.discount=t.getDiscount(e),t.ygen.canAddProducts()?e.variations?t.savewithVariation(e):t.saveupdate(e,c):console.log("Products will not be added")})),this.clearAllItems()}},{key:"saveItem",value:function(t){t.discount=this.getDiscount(t),t.variations?this.savewithVariation(t):this.saveupdate(t,t.$key)}},{key:"saveupdate",value:function(t,e){this.ycat.recievedProductListKeyVal[e]?this.crudList.updateList(t):this.crudList.addtolist(t)}},{key:"perform",value:function(t){switch(console.log(t),t.what){case"add":t.event.discount=this.getDiscount(t.event),this.saveItem(t.event),this.products=this.products.filter((function(e){return e.$key!=t.event.$key})),this.yalert.openSnackBar("Product saved","Ok");break;case"delete":this.products=this.products.filter((function(e){return e.$key!=t.event.$key})),this.yalert.openSnackBar("Product deleted","Ok");break;case"copy":t.event.discount=this.getDiscount(t.event),this.products.push(t.event),this.yalert.openSnackBar("Product copied","Ok")}}},{key:"clearAllItems",value:function(){var t=this;this.products.length=0,this.clearme=!1,setTimeout((function(){t.clearme=!0}),500)}}]),t}(),v.\u0275fac=function(t){return new(t||v)(u.bc(s.R),u.bc(s.Q),u.bc(l.d),u.bc(s.S),u.bc(s.V),u.bc(d.a),u.bc(s.a),u.bc(s.db))},v.\u0275cmp=u.Vb({type:v,selectors:[["app-uploadcatalog"]],decls:13,vars:6,consts:[[3,"color"],["slot","start"],["padding",""],[4,"ngIf"],["style","padding:5px",4,"ngIf"],[1,"productlist"],[3,"product","productlist","onpage","catalogupload","actionevent",4,"ngFor","ngForOf"],["hidden","","type","file","ng2FileSelect","",3,"uploader","change"],["productsFileInput",""],[1,"mat-raised-button","mat-primary",3,"click"],["color","warm",1,"pointer"],[2,"padding","5px"],[1,"mat-raised-button","mat-secondary",3,"click"],[3,"product","productlist","onpage","catalogupload","actionevent"]],template:function(t,e){1&t&&(u.hc(0,"ion-header"),u.hc(1,"ion-toolbar",0),u.hc(2,"ion-buttons",1),u.cc(3,"ion-back-button"),u.gc(),u.hc(4,"ion-title"),u.Xc(5,"Upload Product Catalog"),u.gc(),u.gc(),u.gc(),u.hc(6,"ion-content",2),u.Vc(7,h,7,1,"div",3),u.Vc(8,g,9,0,"div",4),u.hc(9,"ion-item"),u.Xc(10),u.gc(),u.hc(11,"div",5),u.Vc(12,f,1,4,"app-productcard",6),u.gc(),u.gc()),2&t&&(u.Ob(1),u.Cc("color","warning"),u.Ob(6),u.Cc("ngIf",e.clearme),u.Ob(1),u.Cc("ngIf",e.products.length>0),u.Ob(2),u.ad(' You are using "',e.ygen.getSubscriptionType(),'" subscription; You can add max ',e.ygen.maxproductsCanAdded()," products; "),u.Ob(2),u.Cc("ngForOf",e.products))},directives:[o.y,o.fb,o.j,o.f,o.g,o.db,o.s,a.m,o.B,a.l,r.a,p.a,s.D],styles:[".productlist[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch}"]}),v)}],m=((y=function t(){_classCallCheck(this,t)}).\u0275mod=u.Zb({type:y}),y.\u0275inj=u.Yb({factory:function(t){return new(t||y)},imports:[[a.c,i.i,o.gb,s.J,s.o,s.b,r.b,n.n.forChild(b)]]}),y)}}]);