(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{Fnjz:function(t,e,c){"use strict";c.r(e),c.d(e,"UploadcatalogPageModule",(function(){return b}));var i=c("ofXK"),a=c("3Pt+"),s=c("tyNb"),o=c("TEn/"),r=c("7pIB"),n=c("pwB6"),l=c("DVUX"),d=c("fXoL"),u=c("P6Fj"),p=c("NFeN");function h(t,e){if(1&t){const t=d.ic();d.hc(0,"div"),d.hc(1,"input",7,8),d.pc("change",(function(e){return d.Nc(t),d.tc().previewFile(e)})),d.gc(),d.hc(3,"button",9),d.pc("click",(function(){return d.Nc(t),d.Kc(2).click()})),d.hc(4,"mat-icon",10),d.Xc(5,"extension"),d.gc(),d.Xc(6," Add Products Catalog "),d.gc(),d.gc()}if(2&t){const t=d.tc();d.Ob(1),d.Cc("uploader",t.uploader)}}function g(t,e){if(1&t){const t=d.ic();d.hc(0,"div",11),d.hc(1,"button",12),d.pc("click",(function(){return d.Nc(t),d.tc().clearAllItems()})),d.hc(2,"mat-icon",10),d.Xc(3,"delete"),d.gc(),d.Xc(4," Clear All Products "),d.gc(),d.hc(5,"button",9),d.pc("click",(function(){return d.Nc(t),d.tc().saveAllItems()})),d.hc(6,"mat-icon",10),d.Xc(7,"save"),d.gc(),d.Xc(8," Save All Products "),d.gc(),d.gc()}}function v(t,e){if(1&t){const t=d.ic();d.hc(0,"app-productcard",13),d.pc("actionevent",(function(e){return d.Nc(t),d.tc().perform(e)})),d.gc()}if(2&t){const t=e.$implicit,c=d.tc();d.Cc("product",t)("productlist",c.crudList)("onpage","uploadcatalog")("catalogupload",!0)}}const f=[{path:"",component:(()=>{class t{constructor(t,e,c,i,a,s,o,r){this.centerdb=t,this.ycat=e,this.toast=c,this.ydata=i,this.ygen=a,this.papa=s,this.yalert=o,this.photoUploadService=r,this.clearme=!0,this.productlimit=50,this.products=[],this.uploader=r.getUploader(),r.getUploader().clearQueue(),r.getUploader().cancelAll()}ngOnInit(){this.centerdb.currenttenant.subscribe(t=>{t&&(this.crudList=new n.p(n.R.getpath()+"/shop/products",this.ydata.getDatabase(),!0,this.ygen.getUid()),this.crudList.getList().subscribe(t=>{this.productlimit=t.length}))})}previewFile(t){t.srcElement&&t.srcElement.files&&t.srcElement.files[0]&&(t.srcElement.files[0].name.includes(".csv")?(this.toast.pop("success","Got the event & processing "+t.target.files.length+" file","Ok"),this.toast.pop("warn","Reading files","Processing"),this.papa.parse(t.srcElement.files[0],{complete:(t,e)=>{t.errors.forEach(e=>t.data.splice(e.row,1)),t.data.forEach(t=>{t.outofstock=!1,t.soldout=!1;try{t.$key=JSON.parse(t.$key)}catch(e){console.error(t.$key,e)}if(t.isorganic=this.giveflag(t.isorganic),t.istopsaver=this.giveflag(t.istopsaver),t.heavydiscount=this.giveflag(t.heavydiscount),t.newarrival=this.giveflag(t.newarrival),t.isveg=this.giveflag(t.isveg),t.uploaded=this.giveflag(t.uploaded),t.discount=this.getDiscount(t),t.variations){let c=t.variations.replace(/\|/g,",");try{let e=JSON.parse(c),i={},a=0;e.forEach(t=>{i[a]=t,a++}),a>0&&(t.variations=i)}catch(e){t.variations=null}}}),this.products=t.data.filter(t=>!t.uploaded)},delimiter:",",header:!0})):this.yalert.errordata("Only CSV files are allowed"))}giveflag(t){return!!t&&"true"==t.toLowerCase()}getDiscount(t){let e=t.mrp;return(100*(e-t.price)/e).toFixed(0)}savewithVariation(t){let e=this.ydata.getDatabase().createPushId(),c=t.variations;t.discount=this.getDiscount(t),this.ycat.recievedProductListKeyVal[t.$key]?(e=t.$key,delete t.variations,this.ydata.getDatabase().list(n.R.getpath()+"/shop/products/"+e+"/variations").remove(),this.crudList.updateList(t)):(delete t.$key,delete t.variations,this.crudList.getListRefer().set(e,t)),Object.values(c).forEach(t=>{this.ydata.getDatabase().list(n.R.getpath()+"/shop/products/"+e+"/variations").push(t)})}saveAllItems(){this.yalert.openSnackBar("Saving All Products at once","Ok"),this.products.forEach(t=>{let e=t.$key;t.discount=this.getDiscount(t),this.ygen.canAddProducts()?t.variations?this.savewithVariation(t):this.saveupdate(t,e):console.log("Products will not be added")}),this.clearAllItems()}saveItem(t){t.discount=this.getDiscount(t),t.variations?this.savewithVariation(t):this.saveupdate(t,t.$key)}saveupdate(t,e){this.ycat.recievedProductListKeyVal[e]?this.crudList.updateList(t):this.crudList.addtolist(t)}perform(t){switch(console.log(t),t.what){case"add":t.event.discount=this.getDiscount(t.event),this.saveItem(t.event),this.products=this.products.filter(e=>e.$key!=t.event.$key),this.yalert.openSnackBar("Product saved","Ok");break;case"delete":this.products=this.products.filter(e=>e.$key!=t.event.$key),this.yalert.openSnackBar("Product deleted","Ok");break;case"copy":t.event.discount=this.getDiscount(t.event),this.products.push(t.event),this.yalert.openSnackBar("Product copied","Ok")}}clearAllItems(){this.products.length=0,this.clearme=!1,setTimeout(()=>{this.clearme=!0},500)}}return t.\u0275fac=function(e){return new(e||t)(d.bc(n.R),d.bc(n.Q),d.bc(l.d),d.bc(n.S),d.bc(n.V),d.bc(u.a),d.bc(n.a),d.bc(n.db))},t.\u0275cmp=d.Vb({type:t,selectors:[["app-uploadcatalog"]],decls:13,vars:6,consts:[[3,"color"],["slot","start"],["padding",""],[4,"ngIf"],["style","padding:5px",4,"ngIf"],[1,"productlist"],[3,"product","productlist","onpage","catalogupload","actionevent",4,"ngFor","ngForOf"],["hidden","","type","file","ng2FileSelect","",3,"uploader","change"],["productsFileInput",""],[1,"mat-raised-button","mat-primary",3,"click"],["color","warm",1,"pointer"],[2,"padding","5px"],[1,"mat-raised-button","mat-secondary",3,"click"],[3,"product","productlist","onpage","catalogupload","actionevent"]],template:function(t,e){1&t&&(d.hc(0,"ion-header"),d.hc(1,"ion-toolbar",0),d.hc(2,"ion-buttons",1),d.cc(3,"ion-back-button"),d.gc(),d.hc(4,"ion-title"),d.Xc(5,"Upload Product Catalog"),d.gc(),d.gc(),d.gc(),d.hc(6,"ion-content",2),d.Vc(7,h,7,1,"div",3),d.Vc(8,g,9,0,"div",4),d.hc(9,"ion-item"),d.Xc(10),d.gc(),d.hc(11,"div",5),d.Vc(12,v,1,4,"app-productcard",6),d.gc(),d.gc()),2&t&&(d.Ob(1),d.Cc("color","warning"),d.Ob(6),d.Cc("ngIf",e.clearme),d.Ob(1),d.Cc("ngIf",e.products.length>0),d.Ob(2),d.ad(' You are using "',e.ygen.getSubscriptionType(),'" subscription; You can add max ',e.ygen.maxproductsCanAdded()," products; "),d.Ob(2),d.Cc("ngForOf",e.products))},directives:[o.y,o.hb,o.j,o.f,o.g,o.fb,o.s,i.m,o.D,i.l,r.a,p.a,n.D],styles:[".productlist[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch}"]}),t})()}];let b=(()=>{class t{}return t.\u0275mod=d.Zb({type:t}),t.\u0275inj=d.Yb({factory:function(e){return new(e||t)},imports:[[i.c,a.i,o.ib,n.J,n.o,n.b,r.b,s.n.forChild(f)]]}),t})()}}]);